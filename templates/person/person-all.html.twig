{% extends 'base.html.twig' %}

{% set pdfCat = '' %}

{% block body %}
<div class="position-relative overflow-hidden p-3 p-md-1 m-md-2 text-left">
  	<div class="row">
	    <div class="col-sm">
	      	<h3>Personen</h3>
	    </div>
	    
	    {% if is_granted('ROLE_PERSON_CREATE') %}
	    <div class="col-sm">
	      	<a class="btn btn-info btn-sm float-right" href="{{ path('person_create') }}" role="button"><i class="mdi mdi-plus"></i></a>
	    </div>
	    {% endif %} 
	</div>
</div>


<!-- Content -->
<div class="position-relative overflow-hidden p-3 p-md-1 m-md-2 text-left">
	
	<!--Tabs -->
	<nav>
		<div class="nav nav-tabs">
			<li class="nav-item">
				<a class="nav-item nav-link {% if query == 'all' or query == null %}active {% endif %}" href="{{ path('person', {'category': 'all'} ) }}">Alle personen</a>
			</li>
			
			{% for data in category %}
			<li class="nav-item">
				<a class="nav-item nav-link {% if query == data.id %}active {% endif %}" href="{{ path('person', {'category': data.id}) }}">{{ data.name }}</a>
			</li>
			{% endfor %}

  	</div>
  	<!-- End tabs -->



</nav>
	<div class="card">
		<div class="card-body">
			
			
			<!--Table -->
			<table id="datatable-buttons" class="table table-striped table-bordered" cellspacing="0">
                    <thead>
	                    <tr>
							<th width="20px"></th>
	                        <th>Naam</th>
	                        <th>Email</th>
	                        <th>Telefoon</th>
	                        <th>Mobiel</th>
	                        <th>Adres</th>
	                        <th>Categorie</th>
	                    </tr>
                    </thead>

                    <tbody>
                    
                    {% for data in data %}
						<tr>
							<td align="center">
								<!-- Dropdown menu -->
								<div class="btn-group">
								  	<button type="button" class="btn btn-info btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
							  		<div class="dropdown-menu">
							  			<a class="dropdown-item" href="{{ path('person_edit', {'id': data.id}) }}"><i class="mdi mdi-pencil"></i> Bewerken</a>
							  			<a class="dropdown-item" href="{{ path('app_person_delete', {'id': data.id}) }}" onclick="return confirm('Weet je zeker dat je {{ data.familyName }}, {{ data.givenName }} {{ data.additionalName }}wilt verwijderen?');"><i class="mdi mdi-delete text-danger" ></i> Verwijderen</a>
							  		</div>
								</div>
								<!-- End dropdown menu -->
							</td>
							
						    <td>
								<a href="{{ path('person_id', {'id': data.id}) }}"> {{ data.familyName }}, {{ data.givenName }} {{ data.additionalName }}</a>
						    </td>

						    <td>
							    {{ data.email }}
							</td>
						    <td>
							    {{data.telephone}}
							</td>
						    <td>
							    {{data.telephone2}}
							</td>
						    <td>
							    {{data.streetAddress}}{% if data.streetAddress != null %},{% endif %} {{data.addressLocality}}
							</td>
						   
						    <td>
							    <span class="badge badge-info">{{ data.category.name }}</span>
							</td>
						</tr>
					{% endfor %}
                    
                    </tbody>
                </table>		
		</div>
	</div>
</div>
{% endblock %}

{% block javascripts %}

	{{ parent() }}
	
	{% for data in category %}
		{% if query == data.id %}
			{% set pdfCat = data.name %}
		{% endif %}
    {% endfor %}
    {% if query == 'all' or query == null %}
    	{% set pdfCat = 'Alles' %}
	{% endif %}

    <script type="text/javascript">
        $(document).ready(function () {

                var table = $('#datatable-buttons').DataTable({
                    lengthChange: false,
                    "pageLength": 50,
                    "columnDefs": [
					    { "orderable": false, "targets": 0 }
					  ],
                    "order": [[ 1, "asc" ]],
                    buttons: [
	                    {
			                extend: 'csv',
			                exportOptions: {
			                    columns: [ 1, 2, 3, 4, 5 ]
			                }
		                },
	                    {
			                extend: 'print',
			                exportOptions: {
			                    columns: [ 1, 2, 3, 4, 5 ]
			                }
		                },
	                    {
			                extend: 'pdfHtml5',
			                title: '{{ club_name }} - Personenlijst. Categorie: {{ pdfCat }} - Versie: {{ "now"|date("m-d-y") }}',
			                orientation: 'landscape',
			                pageSize: 'A4',
			                exportOptions: {
			                    columns: [ 1, 2, 3, 4, 5 ]
							}
						}],
						"language": {
                	"url": "{{ asset('assets/plugins/datatables/nl_NL.json') }}"
            	},
                });

                table.buttons().container()
                    .appendTo('#datatable-buttons_wrapper .col-md-6:eq(0)');
            });
    </script>
    
{% endblock %}