{% extends 'base.html.twig' %}


{% block stylesheets %}

{{ parent() }}

	<!-- DataTables -->
    <link href="{{ asset('assets/plugins/datatables/dataTables.bootstrap4.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/plugins/datatables/buttons.bootstrap4.min.css') }}" rel="stylesheet" type="text/css" />
    
{% endblock %}       
        

{% block title %}<i class="mdi mdi-cart"></i> Orders{% endblock %}


{% block body %}

<div class="row align-items-center">
    <div class="col">
        <h2>Orders</h2>
    </div>        
</div>
	
	
	<div class="row">
        <div class="col-12">
            <div class="card-box table-responsive">
	            
	            <table id="datatable-buttons" class="table table-striped table-bordered" cellspacing="0">
                    <thead>
                    <tr>
                        <td><b>Order</b></td>
		            	<td><b>Klant</b></td>
		            	<td><b>Datum</b></td>
		            	<td><b>Status</b></td>
		            	<td><b>Artikel</b></td>
		            	<td><b>Totaal</b></td>
                    </tr>
                    </thead>

					<body>
                    
                    {% for data in data %}
				        <tr>
				            <td>
				            	<a href="{{ path('app_order', {'id': data.person.id, 'orderID': data.id}) }}">#{{data.id}}</a>				            
				            </td>
				            <td>
								{{ data.person.familyName }}, {{data.person.givenName }} {{ data.person.additionalName }}
				            </td>
				            	
				            <td>
								{{ data.orderDate ? data.orderDate|date('d-m-Y') }}
				            </td>
				            <td>
				            	{% if data.orderStatus == "In behandeling" %}
				            		<span class="badge badge-pink">{{ data.orderStatus }}</span>
				            	{% endif %}
				            	{% if data.orderStatus == "Afgerond" %}
				            		<span class="badge badge-purple">{{ data.orderStatus }}</span>
				            	{% endif %}
				            	{% if data.orderStatus == "Geannuleerd" %}
				            		<span class="badge badge-secondary">{{ data.orderStatus }}</span>
				            	{% endif %}
				            	{% if data.orderStatus == "In de wacht" %}
				            		<span class="badge badge-pink">{{ data.orderStatus }}</span>
				            	{% endif %}
				            	{% if data.orderStatus == "Terugbetaald" %}
				            		<span class="badge badge-secondary">{{ data.orderStatus }}</span>
				            	{% endif %}
				            	{% if data.orderStatus == "Wachtend op betaling" %}
				            		<span class="badge badge-pink">{{ data.orderStatus }}</span>
				            	{% endif %}
				            </td>
				            <td>
								{% for details in data.orderItem %}	
				            		- {{ details.orderedItem.alternateName }}<br>
				            	{% endfor %}            
				            </td>
				            <td>
			            	{% set totalPrice = 0 %}
			            	
			            	{% for details in data.orderItem %}
			            		
			            		
			            		{% set price = details.orderedItem.price %}
			            		{% set quantity = details.orderQuantity|number_format %}
			            		{% set itemPrice = price * quantity %}
			            		
			            		{% set totalPrice = totalPrice + itemPrice %} 
			
			            	{% endfor %}
			            	â‚¬ {{ totalPrice|number_format(2, '.','') }}
			            			
			            </td>
				        </tr>
				    {% endfor %}                    
				    
				    </tbody>
                </table>
            </div>
        </div>
    </div> 
    <!-- end row -->

{% endblock %}

{% block javascripts %}

	{{ parent() }}

    <!-- Required datatable js -->

    <script src="{{ asset('assets/plugins/datatables/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/dataTables.bootstrap4.min.js') }}"></script>
    
    <!-- Buttons examples -->
    <script src="{{ asset('assets/plugins/datatables/dataTables.buttons.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/buttons.bootstrap4.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/jszip.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/pdfmake.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/vfs_fonts.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/buttons.html5.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/datatables/buttons.print.min.js') }}"></script>
    

    <!-- Key Tables -->
    <script src="{{ asset('assets/plugins/datatables/dataTables.keyTable.min.js') }}"></script>


    <script type="text/javascript">
        $(document).ready(function () {

                var table = $('#datatable-buttons').DataTable({
                    lengthChange: false,
                    "pageLength": 50,
                    "columnDefs": [
					    { "orderable": false, "targets": 0 }
					  ],
                    "order": [[ 1, "asc" ]],
                    buttons: [
	                    {
			                extend: 'csv',
			                exportOptions: {
			                    columns: [ 1, 2, 3, 4, 5 ]
			                }
		                },
	                    {
			                extend: 'print',
			                exportOptions: {
			                    columns: [ 1, 2, 3, 4, 5 ]
			                }
		                },
	                    {
			                extend: 'pdfHtml5',
			                exportOptions: {
			                    columns: [ 1, 2, 3, 4, 5 ]
							}
						}] 
                });

                table.buttons().container()
                    .appendTo('#datatable-buttons_wrapper .col-md-6:eq(0)');
            });
    </script>
    
{% endblock %}